---
title: Twihee - 為什麼 React 需要 key?
date: '2021-10-06'
tags: ['react', '前端', 'frontend', '基礎']
draft: true
summary: Twihee 系列文章，主題不定，會選取平時筆者在 Twitter 上面有趣的程式議題，並把寫成文章 !
authors: ['default']
---

> 此文章是最近在 Twitter 上看到 Dan abramov 的推文，解釋為什麼 React 需要 key，覺得這個主題很有趣，推文講解的也很棒，故把它吸收後用自己的方式寫成文章 !

## 為什麼 React 需要 key ?

作為一名 React 的開發者， 可能曾經收到 React 的 warning，提醒你要記得放 key !

`Warning: Each child in a list should have a unique "key" prop`

比較懶得開發者可能就傳入 index 作為 key，但這其實還是存在問題的! 也是 React 的 anti-pattern。那就值得研究一下為什麼 React 需要 key ?

## React 的 key 有什麼作用 ?

> key 能讓 React 知道那些項目需要被 刪除/更新/插入。

### 集思廣益

想像下兩張圖，從圖一到圖二可能會有幾種變換可能?

![haha](https://miro.medium.com/max/402/1*MGKnbYlJEvIVydEKuNh5kA.png)

如果仔細想一下就會發現，有兩種可能

1. 位置互換，紅圈、藍圈相互交換
2. 顏色改變，紅圈 > 藍圈 & 藍圈 > 紅圈

   正常來說，這兩種改變在畫面中是看不出來的，但想像一下每個色圈內有其本身的狀態(像是 checkbox)，那這樣 **位置交換** 跟 **顏色改變** 就有很大的差異了!

此時我們可以透過實例來驗證一下，假設現在有三個色圈，分別為 紅、藍與黃，並且透過 map 進行頁面的渲染。比較有無放 key 是否會影響 React 的渲染機制。

<Sandpack>

```js
import React from 'react'
import Colors from './Colors.js'

export default () => {
  return <Colors />
}
```

```js file=Colors.js
import React from 'react'
import Color from './Color.js'

const COLORS = ['red', 'blue', 'yellow']

const Colors = () => {
  const [colors, setColors] = React.useState(COLORS)

  return (
    <div>
      <div className="container">
        {colors.map((c) => (
          <Color color={c} />
        ))}
      </div>
      <br />
      <button>add black</button>
    </div>
  )
}

export default Colors
```

```js file=Color.js
import React from 'react'

const Color = ({ color }) => {
  React.useEffect(() => {
    console.log(`${name} mount`)

    return () => {
      console.log(`${name} unmount`)
    }
  }, [color])

  return (
    <div>
      <div className={`circle ${color}`} />
    </div>
  )
}

export default Color
```

```css
.circle {
  height: 50px;
  width: 50px;
  border-radius: 50%;
}

.container {
  display: flex;
}

.container > div {
  padding: 10px;
}

.yellow {
  background: #fde047;
}

.blue {
  background: #2563eb;
}

.red {
  background: #fb7185;
}
```

</Sandpack>
